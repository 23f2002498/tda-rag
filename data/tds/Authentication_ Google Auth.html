<article class="markdown-section" id="main"><h2 id="google-authentication-with-fastapi"><a class="anchor" data-id="google-authentication-with-fastapi" href="#/google-auth?id=google-authentication-with-fastapi"><span>Google Authentication with FastAPI</span></a></h2><p>Secure your API endpoints using Google ID tokens to restrict access to specific email addresses.</p><p><a href="https://youtu.be/4ExQYRCwbzw" rel="noopener" target="_blank"><img alt="ðŸ”¥ Python FastAPI Google Login Tutorial | OAuth2 Authentication (19 min)" data-origin="https://i.ytimg.com/vi_webp/4ExQYRCwbzw/sddefault.webp" src="https://i.ytimg.com/vi_webp/4ExQYRCwbzw/sddefault.webp"/></a></p><p>Google Auth is the most commonly implemented single sign-on mechanism because:</p><ul><li>Itâ€™s popular and user-friendly. Users can log in with their existing Google accounts.</li><li>Itâ€™s secure: Google supports OAuth2 and OpenID Connect to handle authentication.</li></ul><p>Hereâ€™s how you build a FastAPI app that identifies the user.</p><ol><li><p>Go to the <a href="https://console.developers.google.com/apis/credentials" rel="noopener" target="_blank">Google Cloud Console â€“ Credentials</a> and click <strong>Create Credentials &gt; OAuth client ID</strong>.</p></li><li><p>Choose <strong>Web application</strong>, set your authorized redirect URIs (e.g., <code>http://localhost:8000/</code>).</p></li><li><p>Copy the <strong>Client ID</strong> and <strong>Client Secret</strong> into a <code>.env</code> file:</p><pre class="language-env" data-lang="env" v-pre=""><code class="lang-env language-env">GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span aria-hidden="hidden" class="error">Error</span><span aria-hidden="hidden" class="success">Copied</span><span aria-live="polite"></span></button></pre></li><li><p>Create your FastAPI <code>app.py</code>:</p></li></ol><pre class="language-python" data-lang="python" v-pre=""><code class="lang-python language-python"><span class="token comment"># /// script</span>
<span class="token comment"># dependencies = ["python-dotenv", "fastapi", "uvicorn", "itsdangerous", "httpx", "authlib"]</span>
<span class="token comment"># ///</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Request
<span class="token keyword">from</span> fastapi<span class="token punctuation">.</span>responses <span class="token keyword">import</span> RedirectResponse
<span class="token keyword">from</span> starlette<span class="token punctuation">.</span>middleware<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SessionMiddleware
<span class="token keyword">from</span> authlib<span class="token punctuation">.</span>integrations<span class="token punctuation">.</span>starlette_client <span class="token keyword">import</span> OAuth

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>
app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>add_middleware<span class="token punctuation">(</span>SessionMiddleware<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token string">"create-a-random-secret-key"</span><span class="token punctuation">)</span>

oauth <span class="token operator">=</span> OAuth<span class="token punctuation">(</span><span class="token punctuation">)</span>
oauth<span class="token punctuation">.</span>register<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"google"</span><span class="token punctuation">,</span>
    client_id<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"GOOGLE_CLIENT_ID"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    client_secret<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"GOOGLE_CLIENT_SECRET"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    server_metadata_url<span class="token operator">=</span><span class="token string">"https://accounts.google.com/.well-known/openid-configuration"</span><span class="token punctuation">,</span>
    client_kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"scope"</span><span class="token punctuation">:</span> <span class="token string">"openid email profile"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">application</span><span class="token punctuation">(</span>request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span>
    <span class="token comment"># 3. For authenticated users: say hello</span>
    <span class="token keyword">if</span> user<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
    <span class="token comment"># 2. For users who have just logged in, save their details in the session</span>
    <span class="token keyword">if</span> <span class="token string">"code"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">:</span>
        token <span class="token operator">=</span> <span class="token keyword">await</span> oauth<span class="token punctuation">.</span>google<span class="token punctuation">.</span>authorize_access_token<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> token<span class="token punctuation">[</span><span class="token string">"userinfo"</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> RedirectResponse<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token comment"># 1. For users who are logging in for the first time, redirect to Google login</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> oauth<span class="token punctuation">.</span>google<span class="token punctuation">.</span>authorize_redirect<span class="token punctuation">(</span>request<span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> uvicorn
    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span>app<span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span aria-hidden="hidden" class="error">Error</span><span aria-hidden="hidden" class="success">Copied</span><span aria-live="polite"></span></button></pre><p>Now, run <code>uv run app.py</code>.</p><ol><li>When you visit <a href="http://localhost:8000/" rel="noopener" target="_blank">http://localhost:8000/</a> youâ€™ll be redirected to a Google login page.</li><li>When you log in, youâ€™ll be redirected back to <a href="http://localhost:8000/" rel="noopener" target="_blank">http://localhost:8000/</a></li><li>Now youâ€™ll see the email ID you logged in with.</li></ol><p>Instead of displaying the email, you can show different content based on the user. For example:</p><ul><li>Allow access to specfic users and not others</li><li>Fetch the userâ€™s personalized information</li><li>Display different content based on the user</li></ul><div class="docsify-pagination-container">
<div class="pagination-item pagination-item--previous">
<a href="#/fastapi">
<div class="pagination-item-label">
<svg height="16" viewbox="0 0 10 16" width="10" xmlns="http://www.w3.org/2000/svg">
<polyline fill="none" points="8,2 2,8 8,14" vector-effect="non-scaling-stroke"></polyline>
</svg>
<span>Previous</span>
</div>
<div class="pagination-item-title">Web Framework: FastAPI</div>
<div class="pagination-item-subtitle"></div></a>
</div>
<div class="pagination-item pagination-item--next">
<a href="#/ollama">
<div class="pagination-item-label">
<span>Next</span>
<svg height="16" viewbox="0 0 10 16" width="10" xmlns="http://www.w3.org/2000/svg">
<polyline fill="none" points="2,2 8,8 2,14" vector-effect="non-scaling-stroke"></polyline>
</svg>
</div>
<div class="pagination-item-title">Local LLMs: Ollama</div>
<div class="pagination-item-subtitle"></div></a>
</div>
</div></article>