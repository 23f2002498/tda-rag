<article class="markdown-section" id="main"><h2 id="hybrid-retrieval-augmented-generation-hybrid-rag-with-typesense"><a class="anchor" data-id="hybrid-retrieval-augmented-generation-hybrid-rag-with-typesense" href="#/hybrid-rag-typesense?id=hybrid-retrieval-augmented-generation-hybrid-rag-with-typesense"><span>Hybrid Retrieval Augmented Generation (Hybrid RAG) with TypeSense</span></a></h2><p>Hybrid RAG combines semantic (vector) search with traditional keyword search to improve retrieval accuracy and relevance. By mixing exact text matches with embedding-based similarity, you get the best of both worlds: precision when keywords are present, and semantic recall when phrasing varies. <a href="https://typesense.org/" rel="noopener" target="_blank">TypeSense</a> makes this easy with built-in hybrid search and automatic embedding generation.</p><p>Below is a fully self-contained Hybrid RAG tutorial using TypeSense, Python, and the command line.</p><h3 id="install-and-run-typesense"><a class="anchor" data-id="install-and-run-typesense" href="#/hybrid-rag-typesense?id=install-and-run-typesense"><span>Install and run TypeSense</span></a></h3><p><a href="https://typesense.org/docs/guide/install-typesense.html" rel="noopener" target="_blank">Install TypeSense</a>.</p><pre class="language-bash" data-lang="bash" v-pre=""><code class="lang-bash language-bash"><span class="token function">mkdir</span> typesense-data

<span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">8108</span>:8108 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> typesense-data:/data typesense/typesense:28.0 <span class="token punctuation">\</span>
  --data-dir /data <span class="token punctuation">\</span>
  --api-key<span class="token operator">=</span>secret-key <span class="token punctuation">\</span>
  --enable-cors</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span aria-hidden="hidden" class="error">Error</span><span aria-hidden="hidden" class="success">Copied</span><span aria-live="polite"></span></button></pre><ul><li><strong><code>docker run</code></strong>: spins up a containerized TypeSense server on port 8108<ul><li><code>-p 8108:8108</code> maps host port to container port.</li><li><code>-v typesense-data:/data</code> mounts a Docker volume for persistence.</li><li><code>--data-dir /data</code> points TypeSense at that volume.</li><li><code>--api-key=secret-key</code> secures your API.</li><li><code>--enable-cors</code> allows browser-based requests.</li></ul></li></ul><p><strong>Expected output:</strong></p><ul><li>Docker logs showing TypeSense startup messages, such as <code>Started Typesense API server</code>.</li><li>Listening on <code>http://0.0.0.0:8108</code>.</li></ul><h3 id="embed-and-import-documents-into-typesense"><a class="anchor" data-id="embed-and-import-documents-into-typesense" href="#/hybrid-rag-typesense?id=embed-and-import-documents-into-typesense"><span>Embed and import documents into TypeSense</span></a></h3><p>Follow the steps in the <a href="#/rag-cli">RAG with the CLI</a> tutorial to create a <code>chunks.json</code> that has one <code>{id, content}</code> JSON object per line.</p><p><a href="https://typesense.org/docs/28.0/api/vector-search.html#option-b-auto-embedding-generation-within-typesense" rel="noopener" target="_blank">TypeSense supports automatic embedding of documents</a>. Weâ€™ll use that capability.</p><p>Save the following as <code>addnotes.py</code> and run it with <code>uv run addnotes.py</code>.</p><pre class="language-python" data-lang="python" v-pre=""><code class="lang-python language-python"><span class="token comment"># /// script</span>
<span class="token comment"># requires-python = "&gt;=3.13"</span>
<span class="token comment"># dependencies = ["httpx"]</span>
<span class="token comment"># ///</span>
<span class="token keyword">import</span> json
<span class="token keyword">import</span> httpx
<span class="token keyword">import</span> os

headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"X-TYPESENSE-API-KEY"</span><span class="token punctuation">:</span> <span class="token string">"secret-key"</span><span class="token punctuation">}</span>

schema <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"notes"</span><span class="token punctuation">,</span>
    <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"facet"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"content"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"facet"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"embedding"</span><span class="token punctuation">,</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"float[]"</span><span class="token punctuation">,</span>
            <span class="token string">"embed"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"model_config"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"model_name"</span><span class="token punctuation">:</span> <span class="token string">"openai/text-embedding-3-small"</span><span class="token punctuation">,</span>
                    <span class="token string">"api_key"</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"chunks.json"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    chunks <span class="token operator">=</span> <span class="token punctuation">[</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">with</span> httpx<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
    <span class="token comment"># Create the collection</span>
    <span class="token keyword">if</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://localhost:8108/collections/notes"</span></span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>
        r <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://localhost:8108/collections"</span><span class="token punctuation">,</span> json<span class="token operator">=</span>schema<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

    <span class="token comment"># Embed the chunks</span>
    result <span class="token operator">=</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        <span class="token string">"http://localhost:8108/collections/notes/documents/import?action=emplace"</span><span class="token punctuation">,</span>
        headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">**</span>headers<span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        data<span class="token operator">=</span><span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span aria-hidden="hidden" class="error">Error</span><span aria-hidden="hidden" class="success">Copied</span><span aria-live="polite"></span></button></pre><ul><li><strong><code>httpx.Client</code></strong>: an HTTP client for Python.</li><li><strong>Collection schema</strong>: <code>id</code> and <code>content</code> fields plus an <code>embedding</code> field with auto-generated embeddings from OpenAI.</li><li><strong>Auto-embedding</strong>: the <code>embed</code> block instructs TypeSense to call the specified model for each document.</li><li><strong><code>GET /collections/notes</code></strong>: checks existence.</li><li><strong><code>POST /collections</code></strong>: creates the collection.</li><li><strong><code>POST /collections/notes/documents/import?action=emplace</code></strong>: bulk upsert documents, embedding them on the fly.</li></ul><p><strong>Expected output:</strong></p><ul><li>A JSON summary string like <code>{"success": X, "failed": 0}</code> indicating how many docs were imported.</li><li>(On timeouts, re-run until all chunks are processed.)</li></ul><h3 id="_4-run-a-hybrid-search-and-answer-a-question"><a class="anchor" data-id="_4-run-a-hybrid-search-and-answer-a-question" href="#/hybrid-rag-typesense?id=_4-run-a-hybrid-search-and-answer-a-question"><span>4. Run a hybrid search and answer a question</span></a></h3><p>Now, we can use a single <code>curl</code> against the Multi-Search endpoint to combine keyword and vector search as a <a href="https://typesense.org/docs/28.0/api/vector-search.html#hybrid-search" rel="noopener" target="_blank">hybrid search</a>:</p><pre class="language-bash" data-lang="bash" v-pre=""><code class="lang-bash language-bash"><span class="token assign-left variable">Q</span><span class="token operator">=</span><span class="token string">"What does the author affectionately call the =&gt; syntax?"</span>

<span class="token assign-left variable">payload</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq <span class="token parameter variable">-n</span> <span class="token parameter variable">--arg</span> coll <span class="token string">"notes"</span> <span class="token parameter variable">--arg</span> q <span class="token string">"<span class="token variable">$Q</span>"</span> <span class="token punctuation">\</span>
  <span class="token string">'{
     searches: [
       {
         collection: $coll,
         q:           $q,
         query_by:    "content,embedding",
         sort_by:     "_text_match:desc",
         prefix:      false,
         exclude_fields: "embedding"
       }
     ]
   }'</span>
<span class="token variable">)</span></span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">'http://localhost:8108/multi_search'</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-H</span> <span class="token string">"X-TYPESENSE-API-KEY: secret-key"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$payload</span>"</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.results[].hits[].document.content'</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> llm <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">${Q}</span> - \<span class="token variable">$Answer</span> ONLY from these notes. Cite verbatim from the notes."</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> uvx streamdown</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span aria-hidden="hidden" class="error">Error</span><span aria-hidden="hidden" class="success">Copied</span><span aria-live="polite"></span></button></pre><ul><li><strong><code>query_by: "content,embedding"</code></strong>: tells TypeSense to score by both keyword and vector similarity.</li><li><strong><code>sort_by: "_text_match:desc"</code></strong>: boosts exact text hits.</li><li><strong><code>exclude_fields: "embedding"</code></strong>: keeps responses lightweight.</li><li><strong><code>curl -d</code></strong>: posts the search request.</li><li><strong><code>jq -r</code></strong>: extracts each hitâ€™s <code>content</code>. See <a href="https://stedolan.github.io/jq/manual/" rel="noopener" target="_blank">jq manual</a></li><li><strong><code>llm -s</code></strong> and <strong><code>uvx streamdown</code></strong>: generate and stream a grounded answer.</li></ul><p><strong>Expected output:</strong></p><ul><li>The raw matched snippets printed first.</li><li>Then a concise, streamed LLM answer citing the note verbatim.</li></ul><div class="docsify-pagination-container">
<div class="pagination-item pagination-item--previous">
<a href="#/rag-cli">
<div class="pagination-item-label">
<svg height="16" viewbox="0 0 10 16" width="10" xmlns="http://www.w3.org/2000/svg">
<polyline fill="none" points="8,2 2,8 8,14" vector-effect="non-scaling-stroke"></polyline>
</svg>
<span>Previous</span>
</div>
<div class="pagination-item-title">RAG with the CLI)</div>
<div class="pagination-item-subtitle"></div></a>
</div>
<div class="pagination-item pagination-item--next">
<a href="#/function-calling">
<div class="pagination-item-label">
<span>Next</span>
<svg height="16" viewbox="0 0 10 16" width="10" xmlns="http://www.w3.org/2000/svg">
<polyline fill="none" points="2,2 8,8 2,14" vector-effect="non-scaling-stroke"></polyline>
</svg>
</div>
<div class="pagination-item-title">Function Calling</div>
<div class="pagination-item-subtitle"></div></a>
</div>
</div></article>